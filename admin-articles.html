<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration des Articles (Sans style)</title>
     <link rel="stylesheet" href="css/styles.css"> </head>
<link rel="stylesheet" href="css/styles-details-v2.css">

<link rel="stylesheet" href="css/test-styles.css">


    </head>
<body>
    <h1>Gestion des Articles</h1>

    <h2>Ajouter un nouvel article</h2>
    <form id="addArticleForm">
        <div>
            <label for="titre">Titre :</label>
            <input type="text" id="titre" name="titre" required>
        </div>
        <div>
            <label for="imageUrl">URL de l'image :</label>
            <input type="url" id="imageUrl" name="imageUrl" required>
        </div>
        <div>
            <label for="datePublication">Date de publication :</label>
            <input type="date" id="datePublication" name="datePublication" required>
        </div>
        <div>
            <label for="resume">Résumé :</label>
            <textarea id="resume" name="resume" rows="3" required></textarea>
        </div>
        <div>
            <label for="contenuComplet">Contenu Complet :</label>
            <textarea id="contenuComplet" name="contenuComplet" rows="6" required></textarea>
        </div>
        <button type="submit">Ajouter l'article</button>
    </form>

    <h2>Liste des articles existants</h2>
    <div id="articlesList">
        <p>Chargement des articles...</p>
    </div>

    <script>
        // --- Chemins vers les scripts PHP (CORRIGÉS) ---
        // Ces chemins sont corrects si admin-articles.html est dans le dossier 'catalogue/'
        // et les scripts PHP sont dans 'catalogue/backend/'
        const GET_ARTICLES_URL = 'backend/get_articles.php';
        const ADD_ARTICLE_URL = 'backend/add_article.php';
        const UPDATE_ARTICLE_URL = 'backend/update_article.php';
        const DELETE_ARTICLE_URL = 'backend/delete_article.php';
        // --- FIN DES CHEMINS CORRIGÉS ---

        const addArticleForm = document.getElementById('addArticleForm');
        const articlesListDiv = document.getElementById('articlesList');

        // Fonction pour charger et afficher les articles
        async function loadArticles() {
            articlesListDiv.innerHTML = '<p>Chargement des articles...</p>';
            try {
                const response = await fetch(GET_ARTICLES_URL);
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                const articles = await response.json();
                
                if (articles.success && Array.isArray(articles.data)) {
                    articlesListDiv.innerHTML = ''; // Efface le message de chargement
                    if (articles.data.length === 0) {
                        articlesListDiv.innerHTML = '<p>Aucun article trouvé. Ajoutez-en un nouveau !</p>';
                        return;
                    }
                    articles.data.forEach(article => {
                        const articleDiv = document.createElement('div');
                        articleDiv.className = 'article-item'; // Simple classe pour identifier
                        articleDiv.innerHTML = `
                            <img src="${article.image_url}" alt="${article.titre || 'Image d\'article'}" style="max-width:100px; height:auto; margin-right:10px;">
                            <h3>${article.titre} (ID: ${article.id})</h3>
                            <p>Date: ${article.date_publication}</p>
                            <p>${article.resume}</p>
                            <button class="edit-btn" data-id="${article.id}">Modifier</button>
                            <button class="delete-btn" data-id="${article.id}">Supprimer</button>
                            <hr>
                        `;
                        articlesListDiv.appendChild(articleDiv);
                    });
                    attachEventListeners();
                } else {
                    articlesListDiv.innerHTML = `<p>Erreur lors du chargement des articles: ${articles.message || 'Format de données inattendu.'}</p>`;
                    console.error("Erreur de l'API get_articles:", articles.message);
                }
            } catch (error) {
                articlesListDiv.innerHTML = `<p>Erreur lors du chargement des articles: ${error.message}. Vérifiez la console pour plus de détails.</p>`;
                console.error('Erreur de chargement des articles:', error);
            }
        }

        // Fonction pour attacher les écouteurs d'événements
        function attachEventListeners() {
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', async (event) => {
                    const id = event.target.dataset.id;
                    if (confirm(`Êtes-vous sûr de vouloir supprimer l'article ID ${id} ?`)) {
                        try {
                            const response = await fetch(DELETE_ARTICLE_URL, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ id: id })
                            });
                            const result = await response.json();
                            if (result.success) {
                                alert(result.message);
                                loadArticles();
                            } else {
                                alert(`Échec de la suppression: ${result.message}`);
                            }
                        } catch (error) {
                            console.error('Erreur lors de la suppression:', error);
                            alert('Erreur lors de la suppression de l\'article.');
                        }
                    }
                });
            });

            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const id = event.target.dataset.id;
                    alert(`Fonctionnalité de modification pour l'article ID ${id} à implémenter.`);
                });
            });
        }

        // Gérer la soumission du formulaire d'ajout
        addArticleForm.addEventListener('submit', async (event) => {
            event.preventDefault();

            const formData = new FormData(addArticleForm);
            const articleData = {};
            formData.forEach((value, key) => {
                articleData[key] = value;
            });

            try {
                const response = await fetch(ADD_ARTICLE_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(articleData)
                });

                const result = await response.json();

                if (result.success) {
                    alert(result.message);
                    addArticleForm.reset();
                    loadArticles();
                } else {
                    alert(`Échec de l'ajout: ${result.message}`);
                    console.error("Erreur de l'API d'ajout:", result.message);
                }
            } catch (error) {
                console.error('Erreur lors de l\'ajout de l\'article:', error);
                alert('Une erreur est survenue lors de l\'ajout de l\'article. Vérifiez la console.');
            }
        });

        // Charger les articles au chargement de la page
        document.addEventListener('DOMContentLoaded', loadArticles);
    </script>
</body>
</html>